{% extends "base.html" %}

{% block title %}–¢–æ–≤–∞—Ä—ã - –°–∫–ª–∞–¥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤{% endblock %}
{% block header %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏{% endblock %}

{% block content %}
<div class="action-bar">
    <a href="{{ url_for('add_tovar') }}" class="btn btn-primary">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</a>
    <div class="table-info">
        –í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ tovars|length }}
    </div>
</div>

{% if tovars %}
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
            <th>–û–±—ä–µ–º —É–ø–∞–∫–æ–≤–∫–∏</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏</th>
            <th>–°–∫–ª–∞–¥</th>
            <th>–ü–æ—Å—Ç–∞–≤—â–∏–∫</th>
            <th>–£—Å–ª–æ–≤–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
    </thead>
    <tbody>
        {% for tovar in tovars %}
        <tr>
            <td>{{ tovar.id_tov }}</td>
            <td><strong>{{ tovar.category_name }}</strong></td>
            <td>
                <span class="quantity {% if tovar.kol < 50 %}low-quantity{% endif %}">
                    {{ tovar.kol }} {{ tovar.ed_izm }}
                </span>
            </td>
            <td>{{ tovar.ob_ypak }}</td>
            <td><strong>{{ "%.2f"|format(tovar.cena) }} —Ä—É–±.</strong></td>
            <td>
                {% if tovar.srok_god %}
                    {% set days_left = (tovar.srok_god - today).days %}
                    <span class="expiry-date {% if days_left < 30 %}expiring-soon{% endif %}">
                        {{ tovar.srok_god.strftime('%d.%m.%Y') }}
                        {% if days_left < 30 %}
                            <br><small>(–æ—Å—Ç–∞–ª–æ—Å—å {{ days_left }} –¥–Ω.)</small>
                        {% endif %}
                    </span>
                {% else %}
                    <span class="no-expiry">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                {% endif %}
            </td>
            <td>{{ tovar.sklad_adres }}</td>
            <td>{{ tovar.postav_name }}</td>
            <td>{{ tovar.usl_hr|default('–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ', true) }}</td>
            <td class="actions">
                <a href="{{ url_for('edit_tovar', id_tov=tovar.id_tov) }}" class="btn btn-edit">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</a>
                <a href="{{ url_for('delete_tovar', id_tov=tovar.id_tov) }}" class="btn btn-delete" 
                   onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä \"{{ tovar.category_name }}\"?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="no-data">
    <h3>üì≠ –¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
    <p>–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. <a href="{{ url_for('add_tovar') }}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä</a>.</p>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date();
        document.querySelectorAll('.expiry-date').forEach(function(element) {
            // –õ–æ–≥–∏–∫–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ CSS —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å—ã
        });
    });
</script>
{% endblock %}